chrome.runtime.onMessage.addListener(((e,t,r)=>{if("export"===e.action){const t=function(){const e=document.querySelectorAll('[data-testid="tweet"]'),t=e[0]?.querySelector('[data-testid="User-Name"]')?.textContent?.match(/@?\w+/)?.[0]||"";let r=!1;return Array.from(e).filter((e=>{if(r)return!1;const n=e.querySelector('[data-testid="User-Name"]')?.textContent?.match(/@?\w+/)?.[0]||"";return r||n===t?n===t:(r=!0,!1)})).map((e=>{const t=e.querySelector('[data-testid="User-Name"]')?.textContent.replace(/^(.*@\w+)(.*)$/,"$1")||"",r=e.querySelector('[data-testid="tweetText"]')?.textContent||"",n=e.querySelector('[data-testid="tweetText"]')?.innerHTML||"",a=e.querySelector("time")?.textContent||"",o=[];return e.querySelectorAll('img[alt="Image"]').forEach((e=>{o.push({type:"image",url:e.src,alt:e.alt})})),e.querySelectorAll("video").forEach((e=>{o.push({type:"video",url:e.src||e.querySelector("source")?.src,poster:e.poster})})),{author:t,text:r,time:a,media:o,html:n}}))}();if("markdown"===e.format){const e=function(e){const t=e.map((e=>{let t="";return e.media.forEach((e=>{"image"===e.type?t+=`![${e.alt}](${e.url})\n\n`:"video"===e.type&&(t+=`[VIDEO POSTER](${e.poster})\n\n`)})),`${e.html.replace(/<span[^>]*>(.*?)<\/span>/g,"$1").replace(/<a[^>]*href="([^"]*)"[^>]*>(.*?)<\/a>/g,"[$2]($1)").replace(/<[^>]+>/g,"").trim()}\n\n${t}\n\n`})).join("\n");return t?`** ${e[0].author}**\n\n${e[0].time}\n\n${t}`:""}(t);r({content:e})}else if("pdf"===e.format){const e=function(e){const t=e.map((e=>{let t="";return e.media.forEach((e=>{"image"===e.type?t+=`<img src="${e.url}" alt="${e.alt}" style="max-width: 100%;">`:"video"===e.type&&(t+=`<div class="video-container">\n          <img src="${e.poster||""}" alt="VIDEO POSTER" style="max-width: 100%;">\n         \n        </div>`)})),`<div class="tweet">\n      <p>${e.html.replace(/<a[^>]*(?:href="[^"]*"|target="[^"]*")[^>]*>/g,(e=>`<a ${e.match(/href="([^"]*)"/)?.[0]||""} ${e.match(/target="([^"]*)"/)?.[0]||""}>`)).replace(/\n*<a[^>]*>(@\w+)<\/a>/g,"$1").replace(/<div[^>]*>(.*)<\/div>/g,"$1").replace(/<span[^>]*>/g,"<span>").replace(/\n/g,"<br/>")}</p>\n      ${t}\n    </div>`})).join("");return t?`\n    <div class="thread-content">\n      <h1>${e[0].author}</h1>\n      <p class="time">${e[0].time}</p>\n      ${t}\n    </div>\n   `:""}(t);r({content:e})}}}));